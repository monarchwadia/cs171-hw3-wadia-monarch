<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="../libs/d3.v3.min.js"></script>
    <style>
        .axis path,
        .axis line {
                fill: none;
                stroke: lightgrey;
                shape-rendering:crispEdges;
            }

        .dataArea {
            stroke: 1px steelblue;
            fill:steelblue;
            fill-opacity:0.5;
            clip-path: url(#clip);
        }



    </style>

</head>
<body>
    <div id="vis"></div>


	<script>
        /**
         * Created by hen on 2/20/14.
         */
        var bbVis, brush, createVis, dataSet, handle, height, margin, svg, svg2, width;

        margin = {
            top: 50,
            right: 50,
            bottom: 50,
            left: 50
        };

        width = 1250 - margin.left - margin.right;

        height = 700 - margin.bottom - margin.top;

        bbVis = {
            x: 0 + 100,
            y: -height,
            w: width - 100,
            h: height
        };

        dataSet = [];

        svg = d3.select("#vis").append("svg").attr({
            width: width + margin.left + margin.right,
            height: height + margin.top + margin.bottom
        }).append("g").attr({
                    transform: "translate(" + margin.left + "," + margin.top + ")"
                });


        d3.csv("../data.csv", function(data) {

            dataSet = data;
            console.log(dataSet);

            return createVis();
        });

        var xAxis, xScale, yAxis,  yScale, line_PopulationBureau;
        var allPopulationPoints = [];
        var allYears = [];
        var dataSet_PopulationBureau;
        columnNames = ["HYDE", "Maddison", "PopulationBureau", "UN", "USCensus"];

        createVis = function() {

            //Create color scale
            var color = d3.scale.category10();

            // determine maximum and minimum populations

            dataSet.forEach(function(d){allPopulationPoints.push(d.HYDE, d.Maddison, d.PopulationBureau, d.UN, d.USCensus)});
            var maximumPopulation = d3.max(allPopulationPoints, function(d){ if(d!="") return +d });
            var minimumPopulation = d3.min(allPopulationPoints, function(d){ if(d!="") return +d });

            // determine maximum and minimum dates

            dataSet.forEach(function(d){ allYears.push(d.year)});
            var maximumYear = d3.max(allYears, function(d){if(d!="") return +d});
            var minimumYear = d3.min(allYears, function(d){if(d!="") return +d});

            /*
             //THE d3.time.scale() IMPLEMENTATION:
             var maximumYear = new Date(Date.UTC(0,0,1)).setUTCFullYear( d3.max(allYears, function(d){if(d!="") return +d}));
             var minimumYear = new Date(Date.UTC(0,0,1)).setUTCFullYear( d3.min(allYears, function(d){if(d!="") return +d}));
             xScale = d3.time.scale().........
             */

            // create scales with minimum and maximum values

            xScale = d3.scale.linear()
                    .domain([minimumYear, maximumYear])
                    .range([0, bbVis.w]);
            yScale = d3.scale.log()
                    .domain([maximumPopulation, minimumPopulation])
                    .range([0, bbVis.h]);

            // create Axes with scales
            yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");
            xAxis = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");

            //line function


            // example that translates to the bottom left of our vis space:
            var visFrame = svg.append("g").attr({
                "transform": "translate(" + bbVis.x + "," + (bbVis.y + bbVis.h) + ")",
                "class": "estimates"

                //....
            });
            // visFrame.append("rect");
            //....

            //attach the x
            visFrame.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0, "+bbVis.h+")")
                    .call(xAxis)
                    .append("text")
                    .attr("y", 25)
                    .attr("x", width/2)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Year");

            visFrame.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Population");




            for(columnName = 0; columnName <columnNames.length; columnName++){
                svg.append("svg:defs").append("svg:marker")
                        .attr("id", "circleMarker")
                        .attr("viewBox", "-20 -20 50 50")
                        .attr("refX", "5")
                        .attr("refY", "5")
                        .attr("markerWidth", "4")
                        .attr("markerHeight", "4")
                    // .attr("class", columnName[columnNames])
                        .append("circle")
                        .attr("cx", "6")
                        .attr("cy", "6")
                        .attr("r", "20")
                        .style("stroke-width", "1")
                        .style("fill", "none")
                        .style("stroke", color(columnName-1));

                eval(' \
            line_'+columnNames[columnName]+' = d3.svg.line()\
                .x(function(d){return xScale(d.year)})\
                .y(function(d){return yScale(d.'+columnNames[columnName]+')});\
            dataSet_'+columnNames[columnName]+' = [];\
            dataSet.forEach(function(d){\
                if(d.'+columnNames[columnName]+'!=""){ dataSet_'+columnNames[columnName]+'.push(d) };\
            });\
            drawnLine_'+columnNames[columnName]+'=line_'+columnNames[columnName]+'(dataSet_'+columnNames[columnName]+');\
            var timeline_'+columnNames[columnName]+' = svg.selectAll(".'+columnNames[columnName]+'")\
                .data(dataSet_'+columnNames[columnName]+')\
            .enter().append("g")\
                .attr("class", "timeline");\
            timeline_'+columnNames[columnName]+'.append("path")\
                .attr("class", "line '+columnNames[columnName]+'")\
                .attr("d", drawnLine_'+columnNames[columnName]+')\
                .attr("transform", "translate(" + bbVis.x + "," + (bbVis.y + bbVis.h) + ")")\
                .attr("marker-start", "url(#circleMarker)")\
                .attr("marker-mid", "url(#circleMarker)")\
                .attr("marker-end", "url(#circleMarker)")\
                .style("fill", "none")\
                .style("stroke", color(columnName))\
                ;');
            };




        };


	</script>


</body>
</html>